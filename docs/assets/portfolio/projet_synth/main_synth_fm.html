<!doctype html>
<html lang="fr">
  <head>
<style id="synthfm-fix-css">
  #piano-roll, .piano-roll, #rollCanvas, canvas.piano, canvas#piano {
    width: 100%;
    min-height: 320px;
    height: 60vh;         /* espace visible */
    display: block;
  }
  .piano-container, .roll-container, #piano-container { min-height: 60vh; }
</style>

    <meta charset="utf-8" />
    <title>Synth FloMo-Dulator – Séquenceur & FM | Florian Behejohn</title>

    <!-- SEO & Meta -->
    <meta name="description" content="Synth FloMo-Dulator : séquenceur pas-à-pas et synthétiseur FM WebAudio – démo interactive par Florian Behejohn." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- Politique audio : cette page force la pause du lecteur global -->
    <meta name="audio-policy" content="pause" />
    <link rel="canonical" href="https://flobehejohn.github.io/assets/portfolio/projet_synth/main_synth_fm.html" />
    <link rel="icon" href="/assets/images/favicon.ico">
    <!-- CSS vendor -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,300italic,400italic,600italic&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

    <!-- CSS site (root-relatifs) -->
    <link rel="stylesheet" href="/assets/css/theme.min.css" />
    <link rel="stylesheet" href="/assets/css/swatch.bundle.css" />
    <link rel="stylesheet" href="/assets/css/carte_magique.css" />
    <link rel="stylesheet" href="/assets/fonts/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="/assets/css/fixes.css" />

    <!-- CSS du projet (DOIT rester en dernier pour surcharger le thème) -->
    <link rel="stylesheet" href="/assets/css/main_synth_fm.css" data-page-css />

    <!-- Styles locaux (petits blocs informatifs) -->
  </head>

  <body class="normal-header preload">
    <!-- Fond nuage/particules (piloté par /src/nuage_magique/test.js) -->
    <div id="cloud-bg"></div>

    <!-- NAVBAR (liens root-relatifs pour compat PJAX et GitHub Pages) -->
    <nav id="masthead" class="navbar navbar-expand-lg navbar-sticky swatch-custom" role="navigation" aria-label="Navigation principale">
      <div class="container d-flex justify-content-between align-items-center">
        <!-- BRAND -->
        <a href="/index.html" class="navbar-brand d-flex align-items-center">
          <img src="/assets/images/log_zim.webp" alt="Logo" class="brand-logo" />
          <span class="site-title">FLORIAN-BEHEJOHN</span>
        </a>

        <!-- Burger -->
        <button
          class="navbar-toggler collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#main-navbar"
          aria-controls="main-navbar"
          aria-expanded="false"
          aria-label="Menu">
          <span class="navbar-toggler-icon">
            <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
          </span>
        </button>

        <!-- MENU COLLAPSABLE -->
        <div class="collapse navbar-collapse" id="main-navbar">
          <ul class="navbar-nav ms-auto"><!-- <- PAS d’id ici -->
            <li class="nav-item"><a class="nav-link" href="/index.html" data-no-pjax>Accueil</a></li>
            <li class="nav-item"><a class="nav-link" href="/portfolio_florian_b.html" data-no-pjax>Portfolio</a></li>
            <li class="nav-item"><a class="nav-link" href="/parcours.html" data-no-pjax>Parcours</a></li>
            <li class="nav-item"><a class="nav-link" href="/contact.html" data-no-pjax>Contact</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- CONTENU (zone PJAX) -->
    <main data-pjax-root data-page="synth_fm" data-audio="local">

      <div class="container py-4">
        <h1 class="mb-2">Synth FloMo-Dulator</h1>

        <!-- Présentation -->
        <div class="presentation-bloc">
          <strong>Synth FloMo-Dulator</strong> est un synthétiseur FM interactif et séquenceur WebAudio conçu par Florian Behejohn.
          100% JavaScript (AudioWorklet), il permet de façonner des textures évolutives en temps réel, synchronisées au tempo.
        </div>

        <!-- Piano-Roll -->
        <div class="card card--roll mb-4">
          <div class="card-body">
            <h3>Piano-Roll (24 lignes × 16 pas)</h3>
            <div class="piano-roll-wrapper">
              <div id="roll" class="piano-roll"></div>
            </div>
          </div>
        </div>

        <!-- Transport & Modes -->
        <div class="card mb-4">
          <div class="card-body">
            <button class="btn btn-primary" id="audioBtn" type="button">Démarrer l'audio</button>
            <button class="btn btn-secondary" id="seqBtn" type="button" style="margin-left:8px;">Lire Séquence</button>
            <!-- ✅ Bouton diagnostic -->
            <button class="btn btn-outline-success" id="testBtn" type="button" style="margin-left:8px;">Bip test</button>

            <div class="param mt-3">
              <label for="tempo">Tempo (BPM)</label>
              <input id="tempo" type="number" min="40" max="300" value="120" class="form-control w-auto d-inline-block">
            </div>

            <div class="param">
              <label for="playMode">Mode de jeu</label>
              <select id="playMode" class="form-select w-auto d-inline-block">
                <option value="poly" selected>Polyphonique</option>
                <option value="paraph">Paraphonique</option>
                <option value="mono">Monophonique</option>
              </select>
            </div>

            <div class="param">
              <label for="polyCount">Polyphonie (max 16)</label>
              <input id="polyCount" type="range" min="1" max="16" step="1" value="8">
            </div>

            <div class="param">
              <label for="glide">Glide / Portamento (ms)</label>
              <input id="glide" type="range" min="0" max="2500" step="10" value="0">
              <span id="glideVal" class="slider-value">0 ms</span>
            </div>

            <div class="param">
              <label for="masterVol">Volume Master</label>
              <input id="masterVol" type="range" min="0" max="1" step="0.01" value="0.8">
            </div>
          </div>
        </div>


        <!-- Oscillateurs / FM / Morphing -->
        <div class="card mb-4">
          <div class="card-body">
            <h3>Oscillateurs, FM, Morphing</h3>

            <div class="param">
              <label for="wave1">Wave #1</label>
              <select id="wave1" class="form-select w-auto d-inline-block">
                <option value="sine">sine</option>
                <option value="square">square</option>
                <option value="sawtooth" selected>sawtooth</option>
                <option value="triangle">triangle</option>
                <option value="pulse50">pulse50</option>
                <option value="pulse25">pulse25</option>
                <option value="customA">customA</option>
                <option value="customB">customB</option>
              </select>
            </div>

            <div class="param">
              <label for="wave2">Wave #2</label>
              <select id="wave2" class="form-select w-auto d-inline-block">
                <option value="">(aucune)</option>
                <option value="sine">sine</option>
                <option value="square">square</option>
                <option value="sawtooth">sawtooth</option>
                <option value="triangle">triangle</option>
                <option value="pulse50">pulse50</option>
                <option value="pulse25">pulse25</option>
                <option value="customA">customA</option>
                <option value="customB">customB</option>
              </select>
            </div>

            <div class="param">
              <label for="morph">Morph (0 = Wave1 • 1 = Wave2)</label>
              <input id="morph" type="range" min="0" max="1" step="0.01" value="0">
              <span id="morphVal" class="slider-value">0.00</span>
            </div>

            <div class="param">
              <label for="fmRate">FM Rate</label>
              <input id="fmRate" type="range" min="0.1" max="30" step="0.1" value="2">
              <span id="fmRateVal" class="slider-value">2.0</span>
            </div>

            <div class="param">
              <label for="fmDepth">FM Depth</label>
              <input id="fmDepth" type="range" min="0" max="800" step="1" value="80">
              <span id="fmDepthVal" class="slider-value">80</span>
            </div>

            <div class="param">
              <label for="harmonics">Additif (partiels)</label>
              <input id="harmonics" type="range" min="0" max="1" step="0.01" value="0.5">
              <span id="harmonicsVal" class="slider-value">0.50</span>
            </div>

            <h3 class="mt-4">Filtre & Enveloppe</h3>

            <div class="param">
              <label for="filterType">Type de filtre</label>
              <select id="filterType" class="form-select w-auto d-inline-block">
                <option value="lowpass" selected>Lowpass</option>
                <option value="highpass">Highpass</option>
                <option value="bandpass">Bandpass</option>
                <option value="notch">Notch</option>
                <option value="allpass">Allpass</option>
              </select>
            </div>

            <div class="param">
              <label for="filterPoles">Nombre de pôles (1–4)</label>
              <input id="filterPoles" type="range" min="1" max="4" step="1" value="2">
              <span id="polesVal" style="margin-left:6px;">2</span>
            </div>

            <div class="param">
              <label for="cutoff">Cutoff</label>
              <input id="cutoff" type="range" min="80" max="15000" step="1" value="1000">
            </div>

            <div class="param">
              <label for="resonance">Résonance (Q)</label>
              <input id="resonance" type="range" min="0" max="20" step="0.1" value="1">
            </div>

            <div class="param">
              <label for="filterEnv">Env Filtre (Intensité)</label>
              <input id="filterEnv" type="range" min="0" max="5000" step="10" value="1000">
            </div>

            <h3 class="mt-4">ADSR Amplitude</h3>
            <div class="param adsr">
              <label class="me-2">ADSR</label>
              <input id="attack"  type="range" min="0.01" max="3" step="0.01" value="0.1">
              <input id="decay"   type="range" min="0.01" max="3" step="0.01" value="0.2">
              <input id="sustain" type="range" min="0"    max="1" step="0.01" value="0.4">
              <input id="release" type="range" min="0.01" max="5" step="0.01" value="1">
            </div>

            <h3 class="mt-4">Effets & Spatialisation</h3>
            <div class="param">
              <label for="distortion">Distorsion</label>
              <input id="distortion" type="range" min="0" max="1" step="0.01" value="0">
            </div>
            <div class="param">
              <label for="delay">Delay Feedback</label>
              <input id="delay" type="range" min="0" max="0.9" step="0.01" value="0.2">
            </div>
            <div class="param">
              <label for="reverb">Réverbération</label>
              <input id="reverb" type="range" min="0" max="1" step="0.01" value="0.3">
            </div>
            <div class="param">
              <label for="width">Largeur Stéréo (0:Mono / 1:Wide)</label>
              <input id="width" type="range" min="0" max="1" step="0.01" value="0.5">
            </div>

            <h3 class="mt-4">LFO global</h3>
            <div class="param">
              <label for="lfoDiv">LFO Sync (1/xx, synchro tempo)</label>
              <input id="lfoDiv" type="range" min="0" max="8" step="1" value="3">
              <span id="lfoDivLabel" class="slider-value">1/8</span>
            </div>
            <div class="param">
              <label for="lfoDepth">LFO Depth (%)</label>
              <input id="lfoDepth" type="range" min="0" max="200" step="1" value="0">
            </div>
            <div class="param">
              <label for="lfoTarget">LFO Cible</label>
              <select id="lfoTarget" class="form-select w-auto d-inline-block">
                <option value="pan" selected>Stéréo / Pan</option>
                <option value="morph">Morphing</option>
                <option value="cutoff">Cutoff</option>
                <option value="fmDepth">FM Depth</option>
                <option value="am">Amplitude (Tremolo)</option>
              </select>
            </div>

            <div class="note mt-2">
              <b>Astuce :</b> LFO parfaitement calé sur le tempo (1/1 → 1/256) pour des trémolos/vibratos/morphings rythmiques nets.
            </div>
          </div>
        </div>

        <!-- Tonalités / Accords -->
        <div class="card mb-4">
          <div class="card-body">
            <div class="param">
              <label for="rootSelect">Note racine</label>
              <select id="rootSelect" class="form-select w-auto d-inline-block">
                <option value="C">Do</option><option value="C#">Do#</option><option value="D">Ré</option>
                <option value="D#">Ré#</option><option value="E">Mi</option><option value="F">Fa</option>
                <option value="F#">Fa#</option><option value="G">Sol</option><option value="G#">Sol#</option>
                <option value="A" selected>La</option><option value="A#">La#</option><option value="B">Si</option>
              </select>
            </div>
            <div class="param">
              <label for="modeSelect">Mode</label>
              <select id="modeSelect" class="form-select w-auto d-inline-block">
                <option value="maj" selected>Majeur</option>
                <option value="min">Mineur</option>
              </select>
            </div>
            <p class="note mt-2">Ces réglages servent au repérage visuel de la gamme dans la grille.</p>
          </div>
        </div>

        <!-- Mode d'emploi synthétique -->
        <div class="mode-emploi-bloc">
          <h3 class="mb-3">Mode d’emploi & technologies</h3>

          <h4>Architecture</h4>
          <ul>
            <li><strong>Web Audio API + AudioWorklet</strong> (moteur DSP polyphonique)</li>
            <li><strong>JavaScript ES6</strong> (UI/logiciel, piano-roll, séquenceur)</li>
            <li><strong>HTML5 / CSS3</strong> (interface responsive)</li>
          </ul>

          <h4>Utilisation</h4>
          <ul>
            <li>Clique <strong>Démarrer l’audio</strong>, puis <strong>Lire Séquence</strong>.</li>
            <li>Ajoute des notes dans le piano-roll, règle FM/Filtre/ADSR/Effets en temps réel.</li>
            <li>Le LFO suit le tempo pour des modulations propres et musicales.</li>
          </ul>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <footer id="footer" class="swatch-custom text-center py-3">
      <div class="container">
        <p>© 2025 Florian Behejohn — Tous droits réservés.</p>
      </div>
    </footer>

    <!-- JS : ordre sûr (tout en defer) -->
    <!-- 1) Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
    <!-- 2) jQuery (certaines libs thème l’attendent) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" defer></script>
    <!-- 3) Polyfills & patches -->
    <script src="/assets/js/jquery-placeholder-polyfill.js" defer></script>
    <script src="/assets/js/smartresize-patch.js" defer></script>
    <!-- 4) Navbar (auto-close + guards + rebind PJAX) -->
    <script src="/assets/js/navbar.js" defer></script>
    <!-- 5) Router PJAX + Lecteur persistant -->
    <script src="/assets/js/pjax-router.js" defer></script>
    <script src="/assets/js/player-singleton.js" defer></script>
    <!-- 6) Hub de page (root-relatif) -->
    <script src="/assets/js/page-hub.js" defer></script>
    <!-- 7) Plugins/libs éventuels -->
    <script src="/assets/js/packages.min.js" defer></script>
    <!-- 8) Script du thème -->
    <script src="/assets/js/theme.min.js" defer></script>
    <!-- 9) Tes scripts globaux -->
    <script src="/assets/js/animated-text.js" defer></script>
    <script src="/assets/js/script.js" defer></script>
    <!-- 10) Nuage (module ESM) -->
    <script type="module" src="/src/nuage_magique/test.js"></script>

    <!-- 11) NE PAS charger le module du synthé en direct : le hub s'en charge -->
    <!--  -->

    <!-- Petits helpers UI locaux -->
    <script>
      // Retire 'preload' dès que le DOM est prêt
      window.addEventListener('DOMContentLoaded', () => { document.body.classList.remove('preload'); });

      // Miroirs de valeurs sliders & libellés
      document.addEventListener('DOMContentLoaded', () => {
        function bindSlider(id, label, suffix=''){
          const input = document.getElementById(id);
          const span  = document.getElementById(label);
          if (!input || !span) return;
          const upd = () => { span.textContent = input.value + suffix; };
          input.addEventListener('input', upd); upd();
        }
        const poles = document.getElementById('filterPoles');
        const out   = document.getElementById('polesVal');
        if (poles && out){
          const sync = () => out.textContent = poles.value;
          poles.addEventListener('input', sync); sync();
        }
        bindSlider('glide','glideVal',' ms');
        bindSlider('morph','morphVal','');
        bindSlider('fmRate','fmRateVal','');
        bindSlider('fmDepth','fmDepthVal','');
        bindSlider('harmonics','harmonicsVal','');
      });
    </script>
    <!--  c'est le fichier qui diagnostique l'état audio-->
    <!-- en bas de body, sur TOUTES les pages PJAX (home, portfolio, etc.) -->
    <script src="/assets/js/pages/dotnet_boot.js" defer></script>

  <script type="module" src="/src/synth_fm/main_synth_fm.js"></script>
<script id="synthfm-audio-boot">
(()=>{const AC=window.AudioContext||window.webkitAudioContext;let ctx=null;
function resume(){
  try{ if(AC){ ctx=ctx||new AC(); if(ctx.state!=='running') ctx.resume(); } }
  catch(e){ console.warn('Audio resume failed',e); }
  window.dispatchEvent(new CustomEvent('audio-armed'));
  btn?.remove();
  ['pointerdown','keydown','touchstart'].forEach(ev=>document.removeEventListener(ev,resume,{capture:true}));
}
const btn=document.createElement('button');
btn.textContent='▶ Start audio';
Object.assign(btn.style,{position:'fixed',right:'1rem',bottom:'1rem',zIndex:99999,padding:'10px 14px',borderRadius:'999px'});
btn.addEventListener('click',resume,{once:true});
document.addEventListener('DOMContentLoaded',()=>document.body.appendChild(btn));
['pointerdown','keydown','touchstart'].forEach(ev=>document.addEventListener(ev,resume,{once:true,capture:true}));
})();
</script>
<audio id="global-audio" data-react="nuage" crossorigin="anonymous" controls style="position:fixed;left:-10000px;top:-10000px;width:1px;height:1px"></audio>
<script src="/assets/js/synth_fm/main_synth_fm.js"></script>
</body>
</html>





