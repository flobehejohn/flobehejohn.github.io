<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>MusiCam â€“ DÃ©tection de pose & gÃ©nÃ©ration sonore</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Active ta webcam et transforme tes mouvements en musique (synthÃ© WebAudio ou sortie MIDI) avec dÃ©tection de pose + points de visage." />
  <meta name="theme-color" content="#0b0f1a" />
  <link rel="icon" href="data:,">

  <!-- ===== CSS du portfolio (mÃªme pile que les autres pages) ===== -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/assets/css/theme.min.css">
  <link rel="stylesheet" href="/assets/css/swatch.bundle.css">

  <!-- Feuille de style principale de lâ€™app (aprÃ¨s Bootstrap & thÃ¨me pour prioritÃ©) -->
  <link rel="stylesheet" href="/assets/css/musicam.css" />

  <!-- Petit helper pour rÃ©server l'espace sous la navbar sticky -->
  <style>
    /* Fallback CSS (avant JS) : rÃ©serve un espace raisonnable sous la navbar */
    :root { --nav-h: 70px; }
    #navSpacer { height: var(--nav-h); }
    @media (min-width: 992px) {
      :root { --nav-h: 78px; }
    }
  </style>
</head>
<body>
  <noscript>
    <div style="padding:12px; background:#ffefef; color:#900; text-align:center;">
      MusiCam nÃ©cessite JavaScript pour fonctionner (webcam, audio, dÃ©tection de pose).
    </div>
  </noscript>

  <!-- ===== NAVBAR (identique au portfolio) ===== -->
  <nav id="masthead" class="navbar navbar-expand-lg navbar-sticky swatch-custom" style="position:sticky; top:0; z-index:1050;">
    <div class="container d-flex justify-content-between align-items-center">
      <a href="/index.html" class="navbar-brand d-flex align-items-center">
        <img src="/assets/images/log_zim.webp" alt="Logo" class="brand-logo">
        <span class="site-title">FLORIAN-BEHEJOHN</span>
      </a>
      <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Basculer la navigation">
        <span class="navbar-toggler-icon">
          <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
        </span>
      </button>
      <div class="collapse navbar-collapse" id="main-navbar">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="/index.html">Accueil</a></li>
          <li class="nav-item"><a class="nav-link" href="/portfolio_florian_b.html">Portfolio</a></li>
          <li class="nav-item"><a class="nav-link" href="/parcours.html">Parcours</a></li>
          <li class="nav-item"><a class="nav-link" href="/contact.html">Contact</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Espace dynamique sous la navbar pour que le header reste visible -->
  <div id="navSpacer" aria-hidden="true"></div>

  <header class="site-header" role="banner"
        style="
          /* Centrage parfait tablette & desktop */
          margin: 0 auto;
          text-align: center;
          display: grid;
          place-items: center;

          /* Largeur fluide mais contenue sur grands Ã©crans */
          width: min(1100px, 96vw);

          /* Un peu d'air autour du titre */
          padding: 24px 12px;
        ">
  <h1 style="color:#0a0a0a; margin:.2rem 0 .4rem; font-weight:900; letter-spacing:.2px;">
    MusiCam ðŸŽµ
  </h1>

  <p style="color:#0a0a0a; margin:0;">
    Autorise la camÃ©ra (HTTPS), bouge les poignets/coudesâ€¦ et fais sonner le piano du navigateur&nbsp;!
    AprÃ¨s avoir appuyÃ© sur <strong>Â«&nbsp;DÃ©marrer&nbsp;Â»</strong>, attends environ <strong>30&nbsp;secondes</strong> (calibrage)
    jusquâ€™Ã  ce que le <strong>squelette apparaisse</strong> pour confirmer que tout fonctionne.
  </p>
</header>


  <main class="main" role="main">
    <section class="stage" aria-label="ScÃ¨ne vidÃ©o et contrÃ´les">
      <!-- Le conteneur vidÃ©o reÃ§oit les classes .cover/.contain et .mirror -->
      <div id="videoWrap" class="video-wrap cover">
        <!-- NUDGE AUTOPLAY (Firefox/iOS) â€“ vidÃ©o mute cachÃ©e pour lever lâ€™autoplay -->
        <video id="cam" playsinline muted autoplay width="0" height="0" aria-hidden="true"></video>

        <!-- VidÃ©o visible (pilotÃ©e par getUserMedia/applyConstraints) -->
        <video id="webcam" autoplay muted playsinline></video>

        <!-- Overlay (dessinÃ© par draw.worker via OffscreenCanvas ; surface gÃ©rÃ©e cÃ´tÃ© worker) -->
        <canvas id="overlay" aria-hidden="true"></canvas>
      </div>

      <!-- Panneau de contrÃ´le principal -->
      <div class="panel" role="region" aria-label="Panneau de contrÃ´le">
        <div class="row wrap">
          <button id="startBtn" class="btn btn-primary">DÃ©marrer</button>
          <button id="stopBtn" class="btn" disabled>ArrÃªter</button>
          <button id="calibrateBtn" class="btn">Calibrer</button>

          <!-- Geste utilisateur pour initialiser lâ€™audio (iOS/Safari) -->
          <button id="enableAudio" class="btn" title="Initialiser le moteur audio">Activer lâ€™audio</button>

          <div class="spacer" aria-hidden="true"></div>

          <!-- Responsive / pÃ©riphÃ©riques cam -->
          <button id="switchCamBtn" class="btn" title="Basculer camÃ©ra front/back">Inverser camÃ©ra</button>
          <button id="fitToggleBtn" class="btn" title="Alterner cover/contain">Mode: <span id="fitLabel">cover</span></button>

          <!-- Statuts temps rÃ©el -->
          <span id="poseStatus" class="badge" aria-live="polite">Pose: â€”</span>
          <span id="faceStatus" class="badge" aria-live="polite">Face: â€”</span>
          <span id="audioStatus" class="badge" aria-live="polite">Audio: â€”</span>
          <span id="midiStatus" class="badge" aria-live="polite">MIDI: â€”</span>
          <span id="fpsBadge" class="badge" aria-live="polite">FPS: â€”</span>
        </div>

        <!-- ContrÃ´les musicaux de base -->
        <div class="row wrap">
          <label class="ctrl">
            <span>Instrument</span>
            <select id="instrument">
              <option value="piano">Piano (simulÃ©)</option>
              <option value="sine">Sine (onde pure)</option>
              <option value="triangle">Triangle</option>
              <option value="square">CarrÃ© doux</option>
            </select>
          </label>

          <label class="ctrl">
            <span>Mapping</span>
            <select id="mappingMode">
              <option value="fixed">Notes fixes (poignets/coudes)</option>
              <option value="y-pitch">Hauteur = Y (poignets, quantifiÃ©e)</option>
              <option value="drum-limbs">Batterie par membres</option>
              <option value="x-y-theremin">Theremin X/Y (R: pitch, L: filtre)</option>
              <option value="head-bend">Bend/vibrato par tÃªte</option>
            </select>
          </label>

          <label class="ctrl">
            <span>Gamme</span>
            <select id="scale">
              <option value="C_major_pentatonic">C majeur pentatonique</option>
              <option value="C_minor_pentatonic">C mineur pentatonique</option>
              <option value="D_dorian">D dorien</option>
              <option value="G_mixolydian">G mixolydien</option>
            </select>
          </label>

          <label class="ctrl w-300">
            <span>SensibilitÃ© mouvement</span>
            <input id="sensitivity" type="range" min="0.01" max="0.12" step="0.005" value="0.035" />
          </label>

          <label class="ctrl w-220">
            <span>Seuil note-off (ms)</span>
            <input id="noteOffMs" type="number" min="60" max="1000" step="20" value="200" />
          </label>

          <label class="ctrl">
            <span>Sortie</span>
            <select id="audioOut">
              <option value="auto" selected>Auto (MIDI si dispo, sinon synthÃ©)</option>
              <option value="synth">Forcer synthÃ© interne</option>
              <option value="midi">Forcer MIDI (si dispo)</option>
            </select>
          </label>

          <label class="ctrl">
            <span>Visage</span>
            <button id="toggleFace" type="button" aria-pressed="false">Activer</button>
          </label>
        </div>

        <!-- GROS CTA : SynthÃ© avancÃ© (100% responsive) -->
        <details class="w-100 adv" id="advancedDetails">
          <summary role="button" aria-controls="advancedSynth" class="btn btn-primary adv-summary">ðŸ”§ SynthÃ© avancÃ©</summary>

          <!-- Grille responsive auto-fit (1â†’4 colonnes) -->
          <div id="advancedSynth" class="adv-grid">
            <!-- FX / Tempo -->
            <label class="ctrl"><span>Master</span><input data-audio-fx="master" type="range" min="0" max="1" step="0.01" value="0.9"></label>
            <label class="ctrl"><span>Tempo (BPM)</span><input id="tempoBPM" type="number" min="40" max="220" step="1" value="120"></label>

            <!-- ADSR -->
            <label class="ctrl"><span>Attack</span><input data-audio-param="adsrA" type="range" min="0.001" max="2" step="0.001" value="0.03"></label>
            <label class="ctrl"><span>Decay</span><input data-audio-param="adsrD" type="range" min="0.01" max="3" step="0.01" value="0.18"></label>
            <label class="ctrl"><span>Sustain</span><input data-audio-param="adsrS" type="range" min="0" max="1" step="0.01" value="0.65"></label>
            <label class="ctrl"><span>Release</span><input data-audio-param="adsrR" type="range" min="0.01" max="3" step="0.01" value="0.35"></label>

            <!-- Oscillateurs / mix -->
            <label class="ctrl"><span>Wave 1</span>
              <select data-audio-param="wave1">
                <option>sawtooth</option><option>sine</option><option>square</option><option>triangle</option><option>pulse25</option>
              </select>
            </label>
            <label class="ctrl"><span>Wave 2</span>
              <select data-audio-param="wave2">
                <option>sine</option><option>sawtooth</option><option>square</option><option>triangle</option><option>pulse25</option>
              </select>
            </label>
            <label class="ctrl"><span>Morph</span><input data-audio-param="morph" type="range" min="0" max="1" step="0.01" value="0"></label>
            <label class="ctrl"><span>Harmoniques</span><input data-audio-param="harmonics" type="range" min="0" max="1" step="0.01" value="0"></label>

            <!-- Filtre -->
            <label class="ctrl"><span>Cutoff (Hz)</span><input data-audio-param="cutoffHz" type="range" min="80" max="15000" step="1" value="2000"></label>
            <label class="ctrl"><span>RÃ©sonance (Q)</span><input data-audio-param="resonanceQ" type="range" min="0" max="20" step="0.1" value="8"></label>
            <label class="ctrl"><span>Type Filtre</span>
              <select data-audio-param="filterType"><option>lowpass</option><option>highpass</option><option>bandpass</option></select>
            </label>
            <label class="ctrl"><span>PÃ´les</span><input data-audio-param="filterPoles" type="number" min="1" max="8" step="1" value="2"></label>

            <!-- FM / Drive / StÃ©rÃ©o -->
            <label class="ctrl"><span>FM Ratio</span><input data-audio-param="fmRate" type="range" min="0" max="16" step="0.01" value="0"></label>
            <label class="ctrl"><span>FM Depth</span><input data-audio-param="fmDepth" type="range" min="0" max="2" step="0.01" value="0"></label>
            <label class="ctrl"><span>Drive</span><input data-audio-param="drive" type="range" min="0" max="1" step="0.01" value="0.08"></label>
            <label class="ctrl"><span>StÃ©rÃ©o</span><input data-audio-param="width" type="range" min="0" max="1" step="0.01" value="0.25"></label>

            <!-- LFO -->
            <label class="ctrl"><span>LFO Rate</span><input data-audio-param="lfoRate" type="range" min="0" max="20" step="0.01" value="0"></label>
            <label class="ctrl"><span>LFO Depth</span><input data-audio-param="lfoDepth" type="range" min="0" max="1" step="0.001" value="0"></label>
            <label class="ctrl"><span>LFO Target</span>
              <select data-audio-param="lfoTarget"><option>freq</option><option>cutoff</option><option>pan</option><option>morph</option><option>am</option><option>fmDepth</option></select>
            </label>
            <label class="ctrl"><span>Glide (ms)</span><input data-audio-param="glide" type="number" min="0" max="500" step="1" value="0"></label>

            <!-- Modes de jeu -->
            <label class="ctrl"><span>Mode</span>
              <select data-audio-param="playMode"><option value="poly" selected>Poly</option><option value="mono">Mono</option><option value="paraph">Paraph</option></select>
            </label>

            <!-- FX sends -->
            <label class="ctrl"><span>Delay</span><input data-audio-fx="delay" type="range" min="0" max="1" step="0.01" value="0.2"></label>
            <label class="ctrl"><span>Delay FB</span><input data-audio-fx="delayFB" type="range" min="0" max="0.95" step="0.01" value="0.35"></label>
            <label class="ctrl"><span>Reverb</span><input data-audio-fx="reverb" type="range" min="0" max="1" step="0.01" value="0.15"></label>

            <!-- (optionnel) Bend direct -->
            <label class="ctrl"><span>Pitch Bend (Â±12)</span>
              <input data-audio-param="pitchBend" type="range" min="-12" max="12" step="0.01" value="0">
            </label>
          </div>
        </details>

        <!-- Indicateurs & infos -->
        <div class="row">
          <div id="energyWrap" class="energy" role="meter" aria-label="Ã‰nergie du mouvement">
            <div id="energyBar"></div>
            <span id="energyVal">0.00</span>
          </div>
          <small id="videoInfo" class="muted spacer">CamÃ©ra: â€”</small>
          <small class="muted spacer">
            Astuce : sur GitHub Pages, la camÃ©ra nâ€™est autorisÃ©e que via <strong>HTTPS</strong>.
            En local, utilise <code>http://localhost</code> ou <code>http://127.0.0.1</code>.
          </small>
        </div>
      </div>
    </section>

    <section class="help">
      <details>
        <summary>Comment Ã§a marche ?</summary>
        <ul>
          <li><strong>BlazePose</strong> suit 33 repÃ¨res corporels (overlay = squelette + points).</li>
          <li>Mouvement &gt; seuil â‡’ note (MIDI/synthÃ©). En Â« Hauteur = Y Â», la main pilote la hauteur quantifiÃ©e Ã  la gamme.</li>
          <li><strong>FaceMesh</strong> peut ajouter jusquâ€™Ã  ~468 points (optionnel).</li>
        </ul>
      </details>
    </section>
  </main>

  <footer class="site-footer">
    <p>Â© 2025 Florian Behejohn â€” MusiCam</p>
  </footer>

  <!-- ===== JS du portfolio (navbar responsive) ===== -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/assets/js/navbar.js"></script>
  <script src="/assets/js/theme.min.js"></script>

  <!-- Ajuste dynamiquement le spacer en fonction de la hauteur rÃ©elle de la navbar -->
  <script>
    (function () {
      const fixSpacer = () => {
        const nav = document.getElementById('masthead');
        const spacer = document.getElementById('navSpacer');
        if (nav && spacer) spacer.style.height = nav.offsetHeight + 'px';
      };
      window.addEventListener('load', fixSpacer);
      window.addEventListener('resize', fixSpacer);
    })();
  </script>

  <!-- =============== DÃ‰PENDANCES LOCALES (ORDRE STRICT) =============== -->
  <!-- 1) TFJS core (facultatif si tu restes 100% Mediapipe ; le garder ne gÃªne pas) -->
  <script src="/assets/vendor/tfjs/tf.min.js" defer></script>

  <!-- 2) Wrappers TFJS pose/face (si jamais tu changes de runtime) -->
  <script src="/assets/vendor/models/pose-detection.min.js" defer></script>
  <script src="/assets/vendor/models/face-landmarks-detection.min.js" defer></script>

  <!-- 3) Solutions MediaPipe locales (runtime='mediapipe') -->
  <script src="/assets/vendor/mediapipe/pose/pose.js" defer></script>
  <script src="/assets/vendor/mediapipe/face_mesh/face_mesh.js" defer></script>

  <!-- 4) App (ES Module) -->
  <script type="module" src="/assets/js/musicam/musicam.js"></script>
</body>
</html>
